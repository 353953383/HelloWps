<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ‰‹å¢å¼ºç‰ˆé…ç½®æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .nav-tab.active {
            background: white;
            color: #007bff;
            border-bottom-color: #007bff;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .config-section h3 {
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .status-card {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        
        .status-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .status-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        
        .status-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        
        .log-area {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 4px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .log-line {
            margin-bottom: 2px;
            padding: 2px 0;
        }
        
        .log-timestamp {
            color: #888;
        }
        
        .log-error {
            color: #ff6b6b;
        }
        
        .log-success {
            color: #51cf66;
        }
        
        .log-warning {
            color: #ffd43b;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-card {
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .feature-card h4 {
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AIåŠ©æ‰‹å¢å¼ºç‰ˆ</h1>
            <p>è§£å†³CORSé”™è¯¯ã€APIé…ç½®å’Œç½‘ç»œè¯·æ±‚é—®é¢˜</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('config')">é…ç½®ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('test')">åŠŸèƒ½æµ‹è¯•</button>
            <button class="nav-tab" onclick="showTab('logs')">æ—¥å¿—ç›‘æ§</button>
            <button class="nav-tab" onclick="showTab('proxy')">ä»£ç†æœåŠ¡å™¨</button>
            <button class="nav-tab" onclick="showTab('docs')">ä½¿ç”¨æ–‡æ¡£</button>
        </div>
        
        <!-- é…ç½®ç®¡ç† -->
        <div id="config" class="tab-content active">
            <h2>ğŸ”§ APIé…ç½®ç®¡ç†</h2>
            
            <div class="config-section">
                <h3>å½“å‰é…ç½®çŠ¶æ€</h3>
                <div id="config-status"></div>
            </div>
            
            <div class="config-section">
                <h3>åŸºæœ¬é…ç½®</h3>
                <div class="form-group">
                    <label>APIç«¯ç‚¹åœ°å€</label>
                    <input type="url" id="endpoint" class="form-control" placeholder="http://localhost:8080">
                    <small class="text-muted">å»ºè®®ä½¿ç”¨ä»£ç†æœåŠ¡å™¨åœ°å€é¿å…CORSé—®é¢˜</small>
                </div>
                
                <div class="form-group">
                    <label>æ¨¡å‹åç§°</label>
                    <input type="text" id="modelName" class="form-control" placeholder="qwen-plus" value="qwen-plus">
                </div>
                
                <div class="form-group">
                    <label>è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</label>
                    <input type="number" id="timeout" class="form-control" value="30000" min="5000" max="300000">
                </div>
                
                <div class="form-group">
                    <label>æœ€å¤§é‡è¯•æ¬¡æ•°</label>
                    <input type="number" id="maxRetries" class="form-control" value="3" min="0" max="10">
                </div>
                
                <button class="btn btn-primary" onclick="updateConfig()">ä¿å­˜é…ç½®</button>
                <button class="btn btn-warning" onclick="resetConfig()">é‡ç½®é…ç½®</button>
                <button class="btn btn-success" onclick="autoDetectConfig()">æ™ºèƒ½æ£€æµ‹</button>
            </div>
            
            <div class="config-section">
                <h3>é«˜çº§é€‰é¡¹</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="useProxy"> ä½¿ç”¨ä»£ç†æœåŠ¡å™¨
                    </label>
                    <small class="text-muted">æ¨èå¼€å¯ä»¥è§£å†³CORSè·¨åŸŸé—®é¢˜</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableCORS"> å¯ç”¨CORSæ”¯æŒ
                    </label>
                    <small class="text-muted">ä»…åœ¨ä»£ç†æœåŠ¡å™¨ä¸æ”¯æŒæ—¶ä½¿ç”¨</small>
                </div>
            </div>
            
            <div class="config-section">
                <h3>é…ç½®å¯¼å…¥/å¯¼å‡º</h3>
                <button class="btn btn-primary" onclick="exportConfig()">å¯¼å‡ºé…ç½®</button>
                <button class="btn btn-warning" onclick="importConfig()">å¯¼å…¥é…ç½®</button>
                <button class="btn btn-info" onclick="showConfigPreview()">é…ç½®é¢„è§ˆ</button>
            </div>
        </div>
        
        <!-- åŠŸèƒ½æµ‹è¯• -->
        <div id="test" class="tab-content">
            <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ğŸ”Œ è¿æ¥æµ‹è¯•</h4>
                    <p>æµ‹è¯•APIè¿æ¥çŠ¶æ€å’Œå“åº”æ—¶é—´</p>
                    <button class="btn btn-success" onclick="testConnection()">å¼€å§‹æµ‹è¯•</button>
                    <div id="connection-result"></div>
                </div>
                
                <div class="feature-card">
                    <h4>âš™ï¸ é…ç½®éªŒè¯</h4>
                    <p>éªŒè¯å½“å‰é…ç½®çš„æ­£ç¡®æ€§å’Œæœ‰æ•ˆæ€§</p>
                    <button class="btn btn-primary" onclick="validateConfig()">éªŒè¯é…ç½®</button>
                    <div id="validation-result"></div>
                </div>
                
                <div class="feature-card">
                    <h4>ğŸ¤– AIè¯·æ±‚æµ‹è¯•</h4>
                    <p>æµ‹è¯•AIå…¬å¼ç”ŸæˆåŠŸèƒ½</p>
                    <div class="form-group">
                        <label>æµ‹è¯•æè¿°</label>
                        <input type="text" id="testDescription" class="form-control" placeholder="è®¡ç®—Aåˆ—å’ŒBåˆ—çš„å’Œ" value="è®¡ç®—æ€»åº“å­˜">
                    </div>
                    <button class="btn btn-success" onclick="testAIRequest()">å‘é€è¯·æ±‚</button>
                    <div id="ai-test-result"></div>
                </div>
                
                <div class="feature-card">
                    <h4>ğŸ“Š æ€§èƒ½ç»Ÿè®¡</h4>
                    <p>æŸ¥çœ‹è¯·æ±‚ç»Ÿè®¡å’Œæ€§èƒ½æŒ‡æ ‡</p>
                    <button class="btn btn-info" onclick="showStats()">æŸ¥çœ‹ç»Ÿè®¡</button>
                    <div id="stats-result"></div>
                </div>
            </div>
        </div>
        
        <!-- æ—¥å¿—ç›‘æ§ -->
        <div id="logs" class="tab-content">
            <h2>ğŸ“‹ æ—¥å¿—ç›‘æ§</h2>
            
            <div class="config-section">
                <h3>æ—¥å¿—æ§åˆ¶</h3>
                <button class="btn btn-primary" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
                <button class="btn btn-success" onclick="startLogMonitor()">å¼€å§‹ç›‘æ§</button>
                <button class="btn btn-warning" onclick="stopLogMonitor()">åœæ­¢ç›‘æ§</button>
                <button class="btn btn-info" onclick="exportLogs()">å¯¼å‡ºæ—¥å¿—</button>
            </div>
            
            <div class="config-section">
                <h3>å®æ—¶æ—¥å¿—</h3>
                <div class="log-area" id="logArea">
                    <div class="log-line">ç³»ç»Ÿæ—¥å¿—å¯åŠ¨å®Œæˆ...</div>
                </div>
            </div>
        </div>
        
        <!-- ä»£ç†æœåŠ¡å™¨ -->
        <div id="proxy" class="tab-content">
            <h2>ğŸ”„ ä»£ç†æœåŠ¡å™¨</h2>
            
            <div class="config-section">
                <h3>æœåŠ¡å™¨çŠ¶æ€</h3>
                <div id="proxy-status"></div>
            </div>
            
            <div class="config-section">
                <h3>å¯åŠ¨ä»£ç†æœåŠ¡å™¨</h3>
                <p>ä»£ç†æœåŠ¡å™¨ç”¨äºè§£å†³CORSè·¨åŸŸé—®é¢˜ï¼Œéœ€è¦å…ˆå®‰è£…Pythonå’ŒFlask</p>
                <div class="code-block">
# 1. å®‰è£…ä¾èµ–
pip install flask requests flask-cors

# 2. å¯åŠ¨æœåŠ¡å™¨
python server/proxy-server.py

# 3. æ£€æŸ¥çŠ¶æ€
curl http://localhost:8080/api/health
                </div>
                <button class="btn btn-primary" onclick="checkProxyServer()">æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€</button>
                <button class="btn btn-success" onclick="openProxyDocs()">æŸ¥çœ‹æ–‡æ¡£</button>
            </div>
            
            <div class="config-section">
                <h3>é…ç½®è¯´æ˜</h3>
                <div class="status-info status-card">
                    <strong>ç¯å¢ƒå˜é‡é…ç½®</strong><br>
                    åœ¨å¯åŠ¨ä»£ç†æœåŠ¡å™¨ä¹‹å‰ï¼Œè¯·è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
                    <div class="code-block">
# Windows
set DASHSCOPE_API_KEY=your_api_key_here

# Linux/Mac
export DASHSCOPE_API_KEY=your_api_key_here
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä½¿ç”¨æ–‡æ¡£ -->
        <div id="docs" class="tab-content">
            <h2>ğŸ“š ä½¿ç”¨æ–‡æ¡£</h2>
            
            <div class="config-section">
                <h3>é—®é¢˜è§£å†³æ–¹æ¡ˆ</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸš« CORSé”™è¯¯</h4>
                        <p><strong>é—®é¢˜ï¼š</strong>Access-Control-Allow-Originé”™è¯¯</p>
                        <p><strong>è§£å†³ï¼š</strong>ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æˆ–æµè§ˆå™¨æ’ä»¶</p>
                        <div class="code-block">
// ä½¿ç”¨ä»£ç†é…ç½®
apiConfigManager.updateConfig({
    endpoint: 'http://localhost:8080',
    useProxy: true
});
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h4>ğŸ”— ç½‘ç»œé”™è¯¯</h4>
                        <p><strong>é—®é¢˜ï¼š</strong>fetchè¯·æ±‚å¤±è´¥</p>
                        <p><strong>è§£å†³ï¼š</strong>æ£€æŸ¥ç½‘ç»œå’Œä»£ç†æœåŠ¡å™¨</p>
                        <div class="code-block">
// ç½‘ç»œçŠ¶æ€æ£€æŸ¥
const status = await apiConfigManager.testConnection();
if (!status.success) {
    console.log('é”™è¯¯å»ºè®®:', status.suggestions);
}
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h4>âš™ï¸ é…ç½®é”™è¯¯</h4>
                        <p><strong>é—®é¢˜ï¼š</strong>APIé…ç½®ä¸å®Œæ•´</p>
                        <p><strong>è§£å†³ï¼š</strong>ä½¿ç”¨æ™ºèƒ½æ£€æµ‹å’ŒéªŒè¯</p>
                        <div class="code-block">
// æ™ºèƒ½é…ç½®æ£€æµ‹
const detection = await apiConfigManager.detectOptimalConfig();
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h4>â±ï¸ è¶…æ—¶é”™è¯¯</h4>
                        <p><strong>é—®é¢˜ï¼š</strong>è¯·æ±‚è¶…æ—¶</p>
                        <p><strong>è§£å†³ï¼š</strong>è°ƒæ•´è¶…æ—¶å’Œé‡è¯•è®¾ç½®</p>
                        <div class="code-block">
// è°ƒæ•´è¶…æ—¶è®¾ç½®
apiConfigManager.updateConfig({
    timeout: 60000,
    maxRetries: 5
});
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="config-section">
                <h3>APIæ¥å£è¯´æ˜</h3>
                <div class="code-block">
// ä»£ç†æœåŠ¡å™¨APIæ¥å£
POST http://localhost:8080/api/chat/completions
{
  "model": "qwen-plus",
  "messages": [
    {
      "role": "system",
      "content": "ç³»ç»Ÿæç¤ºè¯"
    },
    {
      "role": "user", 
      "content": "ç”¨æˆ·è¾“å…¥"
    }
  ]
}
                </div>
            </div>
            
            <div class="config-section">
                <h3>é›†æˆç¤ºä¾‹</h3>
                <div class="code-block">
// 1. å¼•å…¥é…ç½®ç®¡ç†å™¨
&lt;script src="js/aiHelper/api-config.js"&gt;&lt;/script&gt;

// 2. å¼•å…¥å¢å¼ºAIæ¥å£
&lt;script src="js/aiHelper/enhanced-ai-interface.js"&gt;&lt;/script&gt;

// 3. ä½¿ç”¨æ¥å£
const result = await enhancedAIInterface.generateFormula('è®¡ç®—æ€»å’Œ');
console.log(result);
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¼•å…¥é…ç½®æ–‡ä»¶ -->
    <script src="js/aiHelper/api-config.js"></script>
    <script src="js/aiHelper/enhanced-ai-interface.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let logMonitorInterval = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentConfig();
            addLog('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
        });
        
        // æ ‡ç­¾åˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // åŠ è½½å½“å‰é…ç½®
        function loadCurrentConfig() {
            if (window.apiConfigManager) {
                const config = window.apiConfigManager.getSafeConfig();
                document.getElementById('endpoint').value = config.endpoint;
                document.getElementById('modelName').value = config.modelName;
                document.getElementById('timeout').value = config.timeout;
                document.getElementById('maxRetries').value = config.maxRetries;
                document.getElementById('useProxy').checked = config.useProxy;
                document.getElementById('enableCORS').checked = config.enableCORS;
                
                updateConfigStatus();
            }
        }
        
        // æ›´æ–°é…ç½®çŠ¶æ€
        function updateConfigStatus() {
            if (window.apiConfigManager) {
                const status = window.apiConfigManager.getStatus();
                const statusDiv = document.getElementById('config-status');
                
                statusDiv.innerHTML = `
                    <div class="status-card ${status.isConfigured ? 'status-success' : 'status-error'}">
                        <strong>é…ç½®çŠ¶æ€ï¼š</strong>${status.isConfigured ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}<br>
                        <strong>æœ€åæ£€æŸ¥ï¼š</strong>${status.lastCheck ? new Date(status.lastCheck).toLocaleString() : 'æœªæ£€æŸ¥'}<br>
                        <strong>ç«¯ç‚¹åœ°å€ï¼š</strong>${status.config.endpoint}<br>
                        <strong>æ¨¡å‹åç§°ï¼š</strong>${status.config.modelName}<br>
                        <strong>ä½¿ç”¨ä»£ç†ï¼š</strong>${status.config.useProxy ? 'æ˜¯' : 'å¦'}<br>
                        <strong>è¶…æ—¶è®¾ç½®ï¼š</strong>${status.config.timeout}ms
                    </div>
                `;
            }
        }
        
        // æ›´æ–°é…ç½®
        function updateConfig() {
            if (window.apiConfigManager) {
                const newConfig = {
                    endpoint: document.getElementById('endpoint').value,
                    modelName: document.getElementById('modelName').value,
                    timeout: parseInt(document.getElementById('timeout').value),
                    maxRetries: parseInt(document.getElementById('maxRetries').value),
                    useProxy: document.getElementById('useProxy').checked,
                    enableCORS: document.getElementById('enableCORS').checked
                };
                
                const result = window.apiConfigManager.updateConfig(newConfig);
                
                if (result.success) {
                    addLog('é…ç½®æ›´æ–°æˆåŠŸ', 'success');
                    updateConfigStatus();
                } else {
                    addLog('é…ç½®æ›´æ–°å¤±è´¥', 'error');
                }
            }
        }
        
        // é‡ç½®é…ç½®
        function resetConfig() {
            if (window.apiConfigManager) {
                window.apiConfigManager.resetConfig();
                loadCurrentConfig();
                addLog('é…ç½®å·²é‡ç½®', 'success');
            }
        }
        
        // æ™ºèƒ½æ£€æµ‹
        function autoDetectConfig() {
            if (window.apiConfigManager) {
                addLog('å¼€å§‹æ™ºèƒ½æ£€æµ‹é…ç½®...', 'info');
                
                window.apiConfigManager.detectOptimalConfig().then(result => {
                    addLog('æ™ºèƒ½æ£€æµ‹å®Œæˆ', 'success');
                    loadCurrentConfig();
                    
                    const resultDiv = document.getElementById('validation-result');
                    resultDiv.innerHTML = `
                        <div class="status-info status-card">
                            <strong>æ£€æµ‹ç»“æœï¼š</strong><br>
                            æ¨èé…ç½®: ${result.recommended.endpoint}<br>
                            ä½¿ç”¨ä»£ç†: ${result.recommended.useProxy ? 'æ˜¯' : 'å¦'}
                        </div>
                    `;
                }).catch(error => {
                    addLog('æ™ºèƒ½æ£€æµ‹å¤±è´¥: ' + error.message, 'error');
                });
            }
        }
        
        // éªŒè¯é…ç½®
        function validateConfig() {
            if (window.apiConfigManager) {
                const validation = window.apiConfigManager.validateConfig();
                const resultDiv = document.getElementById('validation-result');
                
                resultDiv.innerHTML = `
                    <div class="status-card ${validation.isValid ? 'status-success' : 'status-error'}">
                        <strong>éªŒè¯ç»“æœï¼š</strong>${validation.isValid ? 'é€šè¿‡' : 'å¤±è´¥'}<br>
                        ${validation.errors.length > 0 ? 'é”™è¯¯åˆ—è¡¨ï¼š' + validation.errors.join(', ') : 'é…ç½®æ­£ç¡®'}
                    </div>
                `;
                
                addLog('é…ç½®éªŒè¯å®Œæˆ', validation.isValid ? 'success' : 'error');
            }
        }
        
        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            if (window.apiConfigManager) {
                addLog('å¼€å§‹è¿æ¥æµ‹è¯•...', 'info');
                
                try {
                    const result = await window.apiConfigManager.testConnection();
                    const resultDiv = document.getElementById('connection-result');
                    
                    if (result.success) {
                        resultDiv.innerHTML = `
                            <div class="status-success status-card">
                                âœ… è¿æ¥æµ‹è¯•æˆåŠŸ<br>
                                ${result.message}
                            </div>
                        `;
                        addLog('è¿æ¥æµ‹è¯•æˆåŠŸ', 'success');
                    } else {
                        resultDiv.innerHTML = `
                            <div class="status-error status-card">
                                âŒ è¿æ¥æµ‹è¯•å¤±è´¥<br>
                                é”™è¯¯: ${result.error}<br>
                                å»ºè®®: ${result.suggestions ? result.suggestions.join('<br>') : ''}
                            </div>
                        `;
                        addLog('è¿æ¥æµ‹è¯•å¤±è´¥: ' + result.error, 'error');
                    }
                } catch (error) {
                    addLog('è¿æ¥æµ‹è¯•å¼‚å¸¸: ' + error.message, 'error');
                }
            }
        }
        
        // æµ‹è¯•AIè¯·æ±‚
        async function testAIRequest() {
            const description = document.getElementById('testDescription').value;
            const resultDiv = document.getElementById('ai-test-result');
            
            if (!description.trim()) {
                addLog('è¯·è¾“å…¥æµ‹è¯•æè¿°', 'warning');
                return;
            }
            
            addLog('å¼€å§‹AIè¯·æ±‚æµ‹è¯•...', 'info');
            resultDiv.innerHTML = '<div class="progress-bar"><div class="progress-fill" style="width: 50%">å¤„ç†ä¸­...</div></div>';
            
            try {
                if (window.enhancedAIInterface) {
                    const result = await window.enhancedAIInterface.generateFormula(description);
                    
                    if (result.success) {
                        resultDiv.innerHTML = `
                            <div class="status-success status-card">
                                âœ… AIè¯·æ±‚æˆåŠŸ<br>
                                ç”Ÿæˆå…¬å¼æ•°é‡: ${result.formulas ? result.formulas.length : 0}<br>
                                å“åº”æ—¶é—´: ${new Date().toLocaleTimeString()}
                            </div>
                        `;
                        addLog('AIè¯·æ±‚æµ‹è¯•æˆåŠŸ', 'success');
                    } else {
                        resultDiv.innerHTML = `
                            <div class="status-error status-card">
                                âŒ AIè¯·æ±‚å¤±è´¥<br>
                                é”™è¯¯: ${result.error || 'æœªçŸ¥é”™è¯¯'}
                            </div>
                        `;
                        addLog('AIè¯·æ±‚å¤±è´¥: ' + result.error, 'error');
                    }
                } else {
                    throw new Error('å¢å¼ºAIæ¥å£æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status-error status-card">
                        âŒ è¯·æ±‚å¼‚å¸¸<br>
                        é”™è¯¯: ${error.message}
                    </div>
                `;
                addLog('AIè¯·æ±‚å¼‚å¸¸: ' + error.message, 'error');
            }
        }
        
        // æ˜¾ç¤ºç»Ÿè®¡
        function showStats() {
            if (window.enhancedAIInterface) {
                const stats = window.enhancedAIInterface.getStats();
                const resultDiv = document.getElementById('stats-result');
                
                resultDiv.innerHTML = `
                    <div class="status-info status-card">
                        <strong>è¯·æ±‚ç»Ÿè®¡ï¼š</strong><br>
                        æ€»è¯·æ±‚æ•°: ${stats.totalRequests}<br>
                        æˆåŠŸè¯·æ±‚: ${stats.successfulRequests}<br>
                        å¤±è´¥è¯·æ±‚: ${stats.failedRequests}<br>
                        æˆåŠŸç‡: ${stats.successRate}<br>
                        é˜Ÿåˆ—é•¿åº¦: ${stats.queueLength}<br>
                        å¤„ç†çŠ¶æ€: ${stats.isProcessing ? 'å¤„ç†ä¸­' : 'ç©ºé—²'}
                    </div>
                `;
                
                addLog('ç»Ÿè®¡ä¿¡æ¯å·²æ›´æ–°', 'info');
            }
        }
        
        // æ£€æŸ¥ä»£ç†æœåŠ¡å™¨çŠ¶æ€
        function checkProxyServer() {
            addLog('æ£€æŸ¥ä»£ç†æœåŠ¡å™¨çŠ¶æ€...', 'info');
            
            fetch('http://localhost:8080/api/health')
                .then(response => response.json())
                .then(data => {
                    const statusDiv = document.getElementById('proxy-status');
                    statusDiv.innerHTML = `
                        <div class="status-success status-card">
                            âœ… ä»£ç†æœåŠ¡å™¨è¿è¡Œæ­£å¸¸<br>
                            å“åº”æ—¶é—´: ${new Date().toLocaleString()}
                        </div>
                    `;
                    addLog('ä»£ç†æœåŠ¡å™¨è¿è¡Œæ­£å¸¸', 'success');
                })
                .catch(error => {
                    const statusDiv = document.getElementById('proxy-status');
                    statusDiv.innerHTML = `
                        <div class="status-error status-card">
                            âŒ ä»£ç†æœåŠ¡å™¨æœªå“åº”<br>
                            é”™è¯¯: ${error.message}
                        </div>
                    `;
                    addLog('ä»£ç†æœåŠ¡å™¨æœªå“åº”', 'error');
                });
        }
        
        // æ‰“å¼€ä»£ç†æ–‡æ¡£
        function openProxyDocs() {
            window.open('ai-interface-improvements.md', '_blank');
        }
        
        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            if (window.apiConfigManager) {
                const config = window.apiConfigManager.exportConfig();
                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ai-helper-config.json';
                a.click();
                URL.revokeObjectURL(url);
                
                addLog('é…ç½®å·²å¯¼å‡º', 'success');
            }
        }
        
        // å¯¼å…¥é…ç½®
        function importConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const config = JSON.parse(e.target.result);
                            if (window.apiConfigManager) {
                                window.apiConfigManager.updateConfig(config.config);
                                loadCurrentConfig();
                                addLog('é…ç½®å¯¼å…¥æˆåŠŸ', 'success');
                            }
                        } catch (error) {
                            addLog('é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // é…ç½®é¢„è§ˆ
        function showConfigPreview() {
            if (window.apiConfigManager) {
                const config = window.apiConfigManager.exportConfig();
                const preview = JSON.stringify(config, null, 2);
                
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `;
                
                modal.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 80%; max-height: 80%; overflow: auto;">
                        <h3>é…ç½®é¢„è§ˆ</h3>
                        <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; font-size: 12px;">${preview}</pre>
                        <button onclick="this.closest('div').parentElement.remove()" class="btn btn-primary">å…³é—­</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
        }
        
        // æ—¥å¿—ç®¡ç†
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logClass = type === 'error' ? 'log-error' : 
                           type === 'success' ? 'log-success' :
                           type === 'warning' ? 'log-warning' : 'log-info';
            
            const logLine = document.createElement('div');
            logLine.className = `log-line ${logClass}`;
            logLine.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> ${message}`;
            
            logArea.appendChild(logLine);
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logArea').innerHTML = '<div class="log-line">æ—¥å¿—å·²æ¸…ç©º...</div>';
        }
        
        function startLogMonitor() {
            if (!logMonitorInterval) {
                logMonitorInterval = setInterval(() => {
                    if (window.apiConfigManager) {
                        const status = window.apiConfigManager.getStatus();
                        addLog(`ç›‘æ§: é…ç½®çŠ¶æ€ ${status.isConfigured ? 'æ­£å¸¸' : 'å¼‚å¸¸'}`, 'info');
                    }
                }, 5000);
                addLog('æ—¥å¿—ç›‘æ§å·²å¯åŠ¨', 'success');
            }
        }
        
        function stopLogMonitor() {
            if (logMonitorInterval) {
                clearInterval(logMonitorInterval);
                logMonitorInterval = null;
                addLog('æ—¥å¿—ç›‘æ§å·²åœæ­¢', 'warning');
            }
        }
        
        function exportLogs() {
            const logArea = document.getElementById('logArea');
            const logs = logArea.innerText;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-helper-logs-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            addLog('æ—¥å¿—å·²å¯¼å‡º', 'success');
        }
    </script>
</body>
</html>