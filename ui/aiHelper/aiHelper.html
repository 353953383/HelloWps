<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>智能办公助手</title>
    
    <!-- 引用公共服务器配置文件 -->
    <script type="text/javascript" src="../../js/util.js"></script>
    <!-- 标准AI API接口 - 严格遵循AIapi.txt规范 -->
    <script type="text/javascript" src="../../js/aiHelper/aiapi-standard.js"></script>
    <script type="text/javascript" src="../../js/aiHelper/api-config.js"></script>
    <script type="text/javascript" src="../../js/aiHelper/formulaGenerator.js"></script>
    <script type="text/javascript" src="../../js/aiHelper/workbookSelector.js"></script>
    <script type="text/javascript" src="../../js/aiHelper/enhanced-ai-interface.js"></script>
    <script type="text/javascript" src="../../js/aiHelper/aiInterface.js"></script>
    <script type="text/javascript" src="js/aiHelper-main.js"></script>
    <link rel="stylesheet" href="css/aiHelper.css">
</head>
<body>
    <div class="ai-helper-container">
        <!-- 头部 -->
        <div class="ai-header">
            <div class="ai-logo">
                <div class="ai-icon">🤖</div>
                <h1>智能公式生成器</h1>
            </div>
            <div class="ai-status">
                <div class="status-indicator" id="aiStatus">准备就绪</div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="ai-main-content">
            <!-- 公式需求输入 -->
            <div class="formula-section" id="formulaSection">
                <h2>📝 公式需求描述</h2>
                <div class="input-group">
                    <textarea 
                        id="formulaDescription" 
                        placeholder="请描述您希望创建的公式功能，例如：&#10;- 计算销售额总和&#10;- 根据条件计算平均值&#10;- 查找特定数据并返回对应值"
                        rows="4"></textarea>
                    <div class="input-tips">
                        <span class="tip-icon">💡</span>
                        <span>请尽量详细描述您的需求，包括计算逻辑和数据来源</span>
                    </div>
                </div>
            </div>

            <!-- 引用范围设置 -->
            <div class="reference-section">
                <h2>🎯 引用范围设置</h2>
                
                <!-- 引用类型选择 -->
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="referenceType" value="current" checked>
                        <span class="radio-custom"></span>
                        <div class="radio-content">
                            <strong>当前工作表</strong>
                            <small>仅引用当前活动工作表的数据</small>
                        </div>
                    </label>
                    
                    <label class="radio-label">
                        <input type="radio" name="referenceType" value="worksheet">
                        <span class="radio-custom"></span>
                        <div class="radio-content">
                            <strong>跨工作表</strong>
                            <small>引用同一工作簿中多个工作表的数据</small>
                        </div>
                    </label>
                    
                    <label class="radio-label">
                        <input type="radio" name="referenceType" value="workbook">
                        <span class="radio-custom"></span>
                        <div class="radio-content">
                            <strong>跨工作簿</strong>
                            <small>引用多个已打开工作簿的数据</small>
                        </div>
                    </label>
                </div>

                <!-- 工作表选择区域 -->
                <div class="selection-area" id="worksheetSelection" style="display: none;">
                    <h3>📊 选择工作表</h3>
                    <div class="selection-panel">
                        <div class="workbook-list" id="workbookList">
                            <!-- 动态加载工作簿列表 -->
                        </div>
                        <div class="worksheet-list" id="worksheetList">
                            <!-- 动态加载工作表列表 -->
                        </div>
                    </div>
                </div>

                <!-- 填充方向设置 -->
                <div class="fill-options">
                    <h3>↗️ 填充方向设置</h3>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="fillDirection" value="none" checked>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>不填充</strong>
                                <small>仅应用于当前单元格</small>
                            </div>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="fillDirection" value="right">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>向右填充</strong>
                                <small>水平方向填充公式</small>
                            </div>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="fillDirection" value="down">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>向下填充</strong>
                                <small>垂直方向填充公式</small>
                            </div>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="fillDirection" value="both">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>双向填充</strong>
                                <small>同时向右和向下填充</small>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- AI生成区域 -->
            <div class="ai-generation-section">
                <h2>🤖 AI智能生成</h2>
                <div class="generation-controls">
                    <button class="btn-primary" id="generateFormula">
                        <span class="btn-icon">🚀</span>
                        生成公式建议
                    </button>
                    <button class="btn-secondary" id="refreshWorkbooks">
                        <span class="btn-icon">🔄</span>
                        刷新工作簿
                    </button>
                </div>
                
                <!-- 加载状态 -->
                <div class="loading-area" id="loadingArea" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">AI正在分析您的需求...</div>
                </div>

                <!-- AI结果展示 -->
                <div class="ai-results" id="aiResults" style="display: none;">
                    <h3>💡 AI建议的公式</h3>
                    <div class="formula-suggestions" id="formulaSuggestions">
                        <!-- 动态生成的公式建议 -->
                    </div>
                </div>
                
                <!-- 应用公式按钮移到这里 -->
                <div class="apply-formula-section" id="applyFormulaSection" style="display: none; margin-top: 15px;">
                    <h3>📋 选择要应用的公式</h3>
                    <div class="formula-apply-options" id="formulaApplyOptions">
                        <!-- 动态生成的公式应用选项 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部操作栏 -->
        <div class="ai-footer">
            <div class="operation-buttons">
                <button class="btn-warning" id="clearAll">
                    <span class="btn-icon">🗑️</span>
                    清空所有
                </button>
            </div>
            <div class="footer-info">
                <span class="info-item">当前单元格: <span id="currentCell">-</span></span>
                <span class="info-item">已选择数据源: <span id="selectedSources">0</span></span>
            </div>
        </div>
    </div>

    <!-- 跨工作簿选择对话框 -->
    <div class="modal" id="workbookModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>选择工作簿</h3>
                <button class="modal-close" onclick="closeWorkbookModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="workbook-selector">
                    <div class="search-box">
                        <input type="text" id="workbookSearch" placeholder="搜索工作簿...">
                    </div>
                    <div class="workbook-grid" id="workbookGrid">
                        <!-- 动态生成工作簿选择网格 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeWorkbookModal()">取消</button>
                <button class="btn-primary" onclick="confirmWorkbookSelection()">确认选择</button>
            </div>
        </div>
    </div>

    <!-- 成功/错误消息提示 -->
    <div class="notification" id="notification" style="display: none;">
        <div class="notification-content">
            <span class="notification-icon"></span>
            <span class="notification-message"></span>
        </div>
    </div>
</body>
</html>